{% extends "the_messages/_base.html" %}
{% load static %}
{% load humanize %}
<!-- Space -->
{% block title %}{{ message.name }} | Messages {% endblock %}
{% block description %}{{ message.name }} by {{ message.author.name }}{% endblock %}
{% block social_title %}Download {{ message.name }} by {{ message.author.name }}{% endblock %}
{% block social_description %}{{ message.description|truncatewords:30 }}{% endblock %}
{% block social_image %}{{ message.thumbnail.url }}{% endblock %}

{% block content %}


<script src="{% static 'src/mess-details.js' %}"></script>

<!-- Banner  -->
{% if not is_subscribed %}
  <div id="marketing-banner" tabindex="-1" class="fixed z-50 flex flex-col md:flex-row justify-between w-[calc(100%-2rem)] p-4 -translate-x-1/2 border rounded-lg shadow-xs lg:max-w-7xl left-1/2 top-6 bg-gray-700 border-gray-600">
    <div class="flex flex-col items-start mb-3 me-4 md:items-center md:flex-row md:mb-0">
      <a href="{% url 'home' %}" class="flex items-center mb-2 md:pe-4 md:me-4 md:border-e md:mb-0 border-gray-600">
        <img src="{% static 'src/images/logo.png' %}" class="h-6 me-2 rounded-md" alt="Vickerdent Studios Logo">
        <span class="self-center text-lg font-semibold whitespace-nowrap text-white">Vickerdent Studios</span>
      </a>
      <p class="flex items-center text-sm font-normal text-gray-400">Get notified when new messages like this are released!</p>
    </div>
    <div class="flex items-center shrink-0">
      <button type="button" onclick="subscribeUser()" class="px-5 py-2 me-2 text-sm font-medium text-white rounded-lg focus:ring-4 bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-blue-800">Notify me</button>
      <button data-dismiss-target="#marketing-banner" type="button" id="close-banner" class="shrink-0 inline-flex justify-center w-7 h-7 items-center text-gray-400 rounded-lg text-sm p-1.5 hover:bg-gray-600 hover:text-white">
        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
        </svg>
        <span class="sr-only">Close banner</span>
      </button>
    </div>
  </div>
{% endif %}

<!-- Toast -->
<div id="toast-danger" class="hidden absolute right-4 top-24 z-40 items-center w-full max-w-xs p-4 rounded-lg shadow-sm text-gray-400 bg-gray-800 border border-gray-500" role="alert">
  <div class="inline-flex items-center justify-center shrink-0 w-8 h-8 rounded-lg bg-red-800 text-red-200">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"/>
    </svg>
    <span class="sr-only">Error icon</span>
  </div>
  <div id="error-message" class="ms-3 text-sm font-normal">An error occurred. Check your notification permissions.</div>
  <button type="button" class="ms-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 inline-flex items-center justify-center h-8 w-8 text-gray-500 hover:text-white bg-gray-800 hover:bg-gray-700" data-dismiss-target="#toast-danger" aria-label="Close">
    <span class="sr-only">Close</span>
    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
    </svg>
  </button>
</div>

<div id="toast-success" class="hidden absolute right-4 top-24 z-40 items-center w-full max-w-xs p-4 rounded-lg shadow-sm text-gray-400 bg-gray-800 border border-gray-500" role="alert">
  <div class="inline-flex items-center justify-center shrink-0 w-8 h-8 rounded-lg bg-green-800 text-green-200">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/>
    </svg>
    <span class="sr-only">Check icon</span>
  </div>
  <div id="success-message" class="ms-3 text-sm font-normal">You have successfully subscribed.</div>
  <button type="button" class="ms-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 inline-flex items-center justify-center h-8 w-8 text-gray-500 hover:text-white bg-gray-800 hover:bg-gray-700" data-dismiss-target="#toast-success" aria-label="Close">
    <span class="sr-only">Close</span>
    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
    </svg>
  </button>
</div>

<!-- Breadcrumb -->
  <section class="bg-gray-800 py-4">
    <div class="max-w-7xl mx-auto px-6">
      <nav class="flex items-center gap-2 text-sm text-gray-400">
        <a href="{% url 'home' %}" class="hover:text-white transition-colors">Home</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        <a href="{% url 'messages' %}" class="hover:text-white transition-colors">Explore</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        <span class="text-white font-medium">{{ message.name }}</span>
      </nav>
    </div>
  </section>

  <!-- Header Section -->
  <section class="gradient-bg py-16">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Message Info -->
        <div class="slide-up">
          <figure class="max-w-lg mb-4">
            <img class="h-auto max-w-full rounded-lg" src="{{ message.thumbnail.url }}" alt="image description">
          </figure>
          <div class="flex items-center gap-3 mb-2">
            {% if message.is_featured %}
            <span class="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold">FEATURED</span>
            {% endif %}
            {% if message.is_sunday_service %}
              <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">SUNDAY SERVICE</span>
            {% endif %}
            {% if message.part_of_group and message.message_group.is_conference %}
            <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
              {{ message.message_group.conference_tag }}
            </span>
            {% endif %}
          </div>

          <h1 class="text-4xl md:text-5xl font-bold mb-4">
            {{ message.name }}
          </h1>

          <div class="flex items-center gap-6 mb-6 text-gray-200">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span class="font-semibold">{{ message.author.name }}</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>{{ message.message_length }}</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span>{{ message.date|date:"l d M Y" }}</span>
            </div>
          </div>

          <p class="text-xl text-gray-200 mb-8 leading-relaxed">
            {{ message.description|truncatewords:30 }}
          </p>

          <div class="flex items-center justify-between bg-white/10 rounded-lg p-4 mb-6">
            <div class="flex items-center gap-4">
              {% if message.part_of_group %}
                <span class="text-sm text-gray-300">{{ message.message_group.name }}</span>
              {% else %}
                <span class="text-sm text-gray-300">{{ message.category }}</span>
              {% endif %}
              <div class="w-px h-4 bg-gray-400"></div>
              <span class="text-sm text-gray-300">54k views</span>
            </div>
            <div class="flex flex-row items-center gap-3">
              <button
                class="p-2 bg-white/20 rounded-full cursor-pointer hover:bg-white/30 transition-colors"
                onclick="sharePage('{{ message.name }} by {{ message.author.name }}', window.location.href)"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                </svg>
              </button>
              <button class="p-2 bg-white/20 rounded-full cursor-pointer hover:bg-white/30 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Download Section -->
        <div class="slide-up" style="animation-delay: 0.2s;">
          <div class="bg-gray-800 rounded-2xl p-8 ">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-2xl font-bold text-gradient">Download Audio</h3>
              {% if attachments|length > 0 %}
              <div class="flex items-center gap-2">
                <div class="pulse-dot w-3 h-3 bg-green-400 rounded-full"></div>
                <span class="text-sm text-green-400 font-semibold">Available</span>
              </div>
              {% else %}
              <div class="flex items-center gap-2">
                <div class="pulse-dot w-3 h-3 bg-red-400 rounded-full"></div>
                <span class="text-sm text-red-400 font-semibold">Uploading</span>
              </div>
              {% endif %}
            </div>

            <!-- Audio Quality Options -->
            <div class="space-y-4 mb-4">
              <button type="button" {% if attachments|length == 0 %} disabled {% endif %} class="{% if attachments|length > 0 %} download-card hover-glow cursor-pointer bg-gray-700 {% else %} cursor-default bg-gray-400 {% endif %} w-full p-4 rounded-xl" onclick="downloadAudio('{{ attachments.0.file.url }}', '{{ message.name }} by {{ message.author.name }}')">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-4">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-3 rounded-lg">
                      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 12.018l-11.89-6.862A1 1 0 002 5.946v12.108a1 1 0 001.646.79l11.89-6.862a1 1 0 000-1.664z"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-semibold text-lg">High Quality MP3</h4>
                      {% if attachments|length > 0 %}
                        <p class="text-gray-400">192 kbps • {{ attachments.0.file.size|filesizeformat }}</p>
                      {% endif %}
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    {% if attachments|length > 0 %}
                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-6 h-6 text-gray-400" viewBox="0 0 16 16">
                      <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
                    </svg>
                    {% endif %}
                  </div>
                </div>
              </button>
            </div>

            <div class="flex items-center justify-between mb-2">
              <h3 class="text-2xl font-bold text-gradient">Other Options</h3>
            </div>

            <div class="flex flex-col gap-4 mb-4">
              <a href="#the_video">
                <div class="download-card bg-gray-700 p-4 rounded-xl hover-glow cursor-pointer">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                      <div class="bg-gradient-to-r from-blue-500 to-cyan-600 p-3 rounded-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 12.018l-11.89-6.862A1 1 0 002 5.946v12.108a1 1 0 001.646.79l11.89-6.862a1 1 0 000-1.664z"></path>
                        </svg>
                      </div>
                      <div>
                        <h4 class="font-semibold text-lg">Watch Video</h4>
                      </div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-6 h-6 text-gray-400" viewBox="0 0 20 20">
                      <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm4 0v6h8V1zm8 8H4v6h8zM1 1v2h2V1zm2 3H1v2h2zM1 7v2h2V7zm2 3H1v2h2zm-2 3v2h2v-2zM15 1h-2v2h2zm-2 3v2h2V4zm2 3h-2v2h2zm-2 3v2h2v-2zm2 3h-2v2h2z"/>
                    </svg>
                  </div>
                </div>
              </a>

              {% if attachments|length > 0 %}
              <a href="#the_video">
                <div class="download-card bg-gray-700 p-4 rounded-xl hover-glow cursor-pointer">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                      <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-3 rounded-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>
                      </div>
                      <div>
                        <h4 class="font-semibold text-lg">Listen to Audio</h4>
                      </div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-6 h-6 text-gray-400" viewBox="0 0 20 20">
                      <path d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13s1.12-2 2.5-2 2.5.896 2.5 2m9-2c0 1.105-1.12 2-2.5 2s-2.5-.895-2.5-2 1.12-2 2.5-2 2.5.895 2.5 2"/>
                      <path fill-rule="evenodd" d="M14 11V2h1v9zM6 3v10H5V3z"/>
                      <path d="M5 2.905a1 1 0 0 1 .9-.995l8-.8a1 1 0 0 1 1.1.995V3L5 4z"/>
                    </svg>
                  </div>
                </div>
              </a>
              {% endif %}
            </div>

            <!-- Download Progress (Hidden by default) -->
            <div id="downloadProgress" class="hidden bg-gray-600 rounded-xl p-4 mb-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-semibold">Downloading...</span>
                <span id="progressPercent" class="text-sm text-gray-300">0%</span>
              </div>
              <div class="bg-gray-700 rounded-full h-2">
                <div id="progressFill" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="flex justify-center items-center w-full">
              <button
                class="border-2 cursor-pointer border-purple-500 text-purple-400 px-10 py-3 rounded-lg font-semibold hover:bg-purple-500 hover:text-white transition-all"
                onclick="sharePage('{{ message.name }} by {{ message.author.name }}', window.location.href)"
              >
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                Share
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-16 bg-gray-900">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Video and Description -->
        <div class="lg:col-span-2">
          <!-- YouTube Video -->
          <div class="mb-8" id="the_video">
            <h3 class="text-2xl font-bold mb-4">Watch Message</h3>
            {% if message.video_url %}
              <div class="video-container bg-gray-800 rounded-xl overflow-hidden">
                <iframe
                  src="{{ message.video_url }}"
                  title="YouTube video player"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allowfullscreen
                >
                </iframe>
              </div>
            {% else %}
              <div class="w-full bg-gray-800 rounded-xl video-container">
                <div class="py-8 px-4 mx-auto text-center lg:py-16 lg:px-12">
                  <svg class="mx-auto mb-4 w-10 h-10 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M331.8 224.1c28.29 0 54.88 10.99 74.86 30.97l19.59 19.59c40.01-17.74 71.25-53.3 81.62-96.65c5.725-23.92 5.34-47.08 .2148-68.4c-2.613-10.88-16.43-14.51-24.34-6.604l-68.9 68.9h-75.6V97.2l68.9-68.9c7.912-7.912 4.275-21.73-6.604-24.34c-21.32-5.125-44.48-5.51-68.4 .2148c-55.3 13.23-98.39 60.22-107.2 116.4C224.5 128.9 224.2 137 224.3 145l82.78 82.86C315.2 225.1 323.5 224.1 331.8 224.1zM384 278.6c-23.16-23.16-57.57-27.57-85.39-13.9L191.1 158L191.1 95.99l-127.1-95.99L0 63.1l96 127.1l62.04 .0077l106.7 106.6c-13.67 27.82-9.251 62.23 13.91 85.39l117 117.1c14.62 14.5 38.21 14.5 52.71-.0016l52.75-52.75c14.5-14.5 14.5-38.08-.0016-52.71L384 278.6zM227.9 307L168.7 247.9l-148.9 148.9c-26.37 26.37-26.37 69.08 0 95.45C32.96 505.4 50.21 512 67.5 512s34.54-6.592 47.72-19.78l119.1-119.1C225.5 352.3 222.6 329.4 227.9 307zM64 472c-13.25 0-24-10.75-24-24c0-13.26 10.75-24 24-24S88 434.7 88 448C88 461.3 77.25 472 64 472z"/></svg>
                  <h1 class="mb-4 text-4xl font-bold tracking-tight leading-none lg:mb-6 md:text-5xl xl:text-6xl text-white">Video is Unavailable</h1>
                  <p class="font-light md:text-lg xl:text-xl text-gray-400">We're doing our best to bring the video online. Please exercise patience.</p>
                </div>
              </div>
            {% endif %}
          </div>

          <!-- Audio Player -->
          {% if attachments|length > 0 %}
          <div class="audio-controls rounded-xl p-6 mb-8" id="the_audio">
            <div class="flex items-center justify-between mb-4">
              <h4 class="text-lg font-semibold">Listen to Audio Message</h4>
              <span class="text-sm text-gray-200">{{ message.message_length }}</span>
            </div>
            <div class="flex items-center gap-4">
              <audio id="player" hidden>
                <source id="source" src="{{ attachments.0.file.url }}">
              </audio>
              <button id="playButton" data-time="{{ audio_length }}" class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full transition-colors cursor-pointer">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                </svg>
              </button>
              <div class="flex-1 bg-gray-700 rounded-full h-2">
                <div class="progress-bar h-2 rounded-full" style="width: 0%" id="audioProgress"></div>
              </div>
              <div class="flex items-center gap-2">
                <!-- <button class="text-gray-400 hover:text-white transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 12.018l-11.89-6.862A1 1 0 002 5.946v12.108a1 1 0 001.646.79l11.89-6.862a1 1 0 000-1.664z"></path>
                  </svg>
                </button> -->
                <span class="text-sm text-gray-400 w-16">00:00</span>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Message Description -->
          <div class="bg-gray-800 rounded-xl p-8 mb-8">
            <h3 class="text-2xl font-bold mb-6">About This Message</h3>
            <div class="space-y-4 text-gray-300 leading-relaxed">
              <p>{{ message.description }}</p>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <!-- Speaker Info -->
          <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <div class="text-center mb-6">
              <div class="flex items-center justify-center">
                {% if message.author.photo %}
                  <img src="{{ message.author.photo.url }}" alt="{{ message.author.name }}" class="w-24 h-24 rounded-full object-cover">
                {% else %}
                  <div class="w-24 h-24 bg-gray-600 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                    {{ message.author.name|slice:":1" }}
                  </div>
                {% endif %}
              </div>
              <h3 class="text-xl font-bold">{{ message.author.name }}</h3>
              <p class="text-gray-400 mb-4">{{ message.author.brief_desc }}</p>
            </div>

            <p class="text-gray-300 text-sm mb-6 leading-relaxed">
              {{ message.author.biography|truncatewords:50 }}
            </p>

            <div class="space-y-3">
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-400">Messages</span>
                <span class="font-semibold">{{ message.author.messages.count }}</span>
              </div>
            </div>

            <div class="mt-6">
              <button class="w-full bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all">
                Follow Speaker
              </button>
            </div>
          </div>

          <!-- Message Details -->
          <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold mb-4">Message Details</h3>
            <div class="space-y-4 text-sm">
              {% if message.part_of_group and message.message_group.is_conference %}
                <div class="flex justify-between">
                  <span class="text-gray-400">Event</span>
                  <span class="font-semibold">{{ message.message_group.conference_name }}</span>
                </div>
              {% endif %}
              <div class="flex justify-between">
                <span class="text-gray-400">Date</span>
                <span class="font-semibold">{{ message.date|date:"M d, Y" }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Duration</span>
                <span class="font-semibold">{{ message.message_length }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Category</span>
                <span class="font-semibold">{{ message.category }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Language</span>
                <span class="font-semibold">English</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Downloads</span>
                <span class="font-semibold">8.4K</span>
              </div>
            </div>
          </div>

          <!-- Tags -->
          <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold mb-4">Tags</h3>
            <div class="flex flex-wrap gap-2">
              <span class="bg-purple-600/20 text-purple-300 px-3 py-1 rounded-full text-sm">#Purpose</span>
              <span class="bg-blue-600/20 text-blue-300 px-3 py-1 rounded-full text-sm">#Calling</span>
              <span class="bg-green-600/20 text-green-300 px-3 py-1 rounded-full text-sm">#Faith</span>
              <span class="bg-yellow-600/20 text-yellow-300 px-3 py-1 rounded-full text-sm">#Identity</span>
              <span class="bg-red-600/20 text-red-300 px-3 py-1 rounded-full text-sm">#Direction</span>
              <span class="bg-indigo-600/20 text-indigo-300 px-3 py-1 rounded-full text-sm">#Destiny</span>
            </div>
          </div>

          <!-- Related Messages -->
          <div class="bg-gray-800 rounded-xl p-6">
            <h3 class="text-lg font-bold mb-4">Related Messages</h3>
            <div class="flex flex-col gap-4">
              {% for message in related_messages %}
                <a href="{% url 'message_details' message.id %}" class="hover:no-underline">
                  <div class="related-card bg-gray-700 p-4 rounded-lg">
                    <div class="flex gap-3">
                      <img src="{{ message.thumbnail.url }}" alt="{{ message.name }}" class="w-16 h-16 rounded-lg object-cover flex-shrink-0">
                      <div class="flex-1">
                        <h4 class="font-semibold text-sm mb-1">{{ message.name }}</h4>
                        <p class="text-gray-400 text-xs mb-1">{{ message.author.name }}</p>
                        <p class="text-gray-500 text-xs">{{ message.message_length }} • {{ message.date|date:"M d, Y" }}</p>
                      </div>
                    </div>
                  </div>
                </a>
              {% endfor %}
            </div>

            <div class="mt-4">
              <a href="{% url 'messages' %}" class="text-purple-400 hover:text-purple-300 transition-colors text-sm">
                View all messages →
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Comments Section -->
  <section class="py-16 bg-gray-800">
    <div class="max-w-7xl mx-auto px-6">
      <div class="max-w-4xl">
        <div class="flex items-center justify-between mb-8">
          <h3 class="text-2xl font-bold">Comments</h3>
          <div class="flex items-center gap-4">
            <span class="text-sm text-gray-400">{{ comments|length }} comments</span>
          </div>
        </div>

        <!-- Add Comment -->
        <div class="bg-gray-700 rounded-xl p-6 mb-8">
          <div class="flex gap-4">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            <form action="{% url 'add_comment' message.id %}" method="POST" class="flex-1">
              {% csrf_token %}
              {{ form.user_name.errors }}
              <input type="text" name="user_name" placeholder="Your Name" class="w-full mb-3 bg-gray-800 border border-gray-600 rounded-lg p-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"/>
              {{ form.content.errors }}
              <textarea
                name="content"
                placeholder="Share your thoughts about this message..."
                class="w-full bg-gray-800 border border-gray-600 rounded-lg p-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"
                rows="3"
              ></textarea>
              <div class="flex items-center justify-between mt-4">
                <button type="submit" class="bg-gradient-to-r from-purple-600 to-blue-600 px-6 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all cursor-pointer">
                  Post Comment
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Comments List -->
        <div class="space-y-6">
          {% for comment in comments %}
          <div class="bg-gray-700 rounded-xl p-6">
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center">
                  <span class="text-white font-semibold text-sm">{{ comment.user_name|slice:":2" }}</span>
                </div>
                <div>
                  <h4 class="font-semibold">{{ comment.user_name }}</h4>
                  <div class="flex items-center gap-2 text-xs text-gray-400">
                    <span>{{ comment.created_at|naturaltime }}</span>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-gray-300 mb-4 leading-relaxed">
              {{ comment.content }}
            </p>
            <div class="flex items-center gap-4 text-sm">
              <button id="like-button-{{ comment.id }}" class="flex items-center gap-1 text-gray-400 hover:text-purple-400 transition-colors cursor-pointer" type="button">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                </svg>
                <span>{{ comment.likes }}</span>
              </button>
              <!-- <button class="text-gray-400 hover:text-purple-400 transition-colors">Reply</button> -->
            </div>
          </div>
          {% empty %}
            <p class="text-gray-400">No comments yet. Be the first to comment!</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

{% endblock content %}
